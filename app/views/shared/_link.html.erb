<%#
  Parameters:
    - target:
        Will be passed to link_to. Required if 'as_button' is not specified.
    - text:
        The text to display in the link. Required.
    - class:
        The classes to apply.
    - icon:
        An icon identifier. You can find all icons in '/app/assets/images/icons'.
        You shouldn't include the '.svg' extension.
    - highlight:
        If true, the link will always be highlighted. Defaults to false.
    - content_attr:
        The attributes to assign to the content.
    - text_attr:
        The attributes to assign to the text (NOT the icon).
    - as_button:
        If defined, a <button> will be produced instead of a link. The given attributes
        will be assigned to it as well.
    - underline_attr:
        The attributes to assign to the underline decoration.
    - large:
        If true, a the link will be styled to be larger. (text-2xl, larger icon,
        larger underline). Defaults to false.
%>
<% raise "shared/link requires 'text' as a local" unless local_assigns[:text] %>

<% as_button    = local_assigns[:as_button] %>
<% highlight    = local_assigns.fetch(:highlight, false) %>
<% large        = local_assigns.fetch(:large, false) %>
<% content_attr     = local_assigns.fetch(:content_attr, {}) %>
<% text_attr        = local_assigns.fetch(:text_attr, {}) %>
<% underline_attr   = local_assigns.fetch(:underline_attr, {}) %>

<% base_class   = "relative inline-block group py-2 cursor-pointer #{'text-2xl' if large}" %>
<% final_class  = [base_class, local_assigns[:class]].compact.join(" ") %>

<% if as_button %>
  <% btn_opts = { type: 'button', class: final_class } %>
  <% btn_opts[:data] = as_button[:data] if as_button[:data].is_a?(Hash) %>

  <%= content_tag :button, btn_opts do %>
    <%= tag.span(
      class: "relative z-10 flex items-center space-x-2 #{content_attr.delete(:class)}".strip,
      **content_attr
    ) do %>
      <% if local_assigns[:icon] %>
        <%= inline_svg "icons/#{icon}.svg", class: "#{large ? 'w-6' : 'w-4'} h-min mr-4" %>
      <% end %>

      <%= tag.span(
        class: "text-nowrap tracking-tight #{text_attr.delete(:class)}".strip,
        **text_attr
      ) do %>
        <%= text %>
      <% end %>
    <% end %>

    <%= tag.div(
      class: "
        absolute bottom-1 -right-1 w-full pr-3 box-content h-6
        bg-[#C7A077] rounded-full z-0 group-hover:opacity-100
        #{'opacity-0' unless highlight}
        #{underline_attr.delete(:class)}".strip,
      data: { kind: "underline" }.merge(underline_attr.delete(:data) || {}),
      **underline_attr
    ) %>
  <% end %>
<% else %>
  <%= link_to target, class: final_class do %>
    <%= tag.span(
      class: "relative z-10 flex items-center space-x-2 #{content_attr.delete(:class)}".strip,
      **content_attr
    ) do %>
      <% if local_assigns[:icon] %>
        <%= inline_svg "icons/#{icon}.svg", class: "w-6 h-min mr-4" %>
      <% end %>

      <%= tag.span(
        class: "text-nowrap tracking-tight pointer-events-none #{text_attr.delete(:class)}".strip,
        **text_attr
      ) do %>
        <%= text %>
      <% end %>
    <% end %>

    <%= tag.div(
      class: "
        absolute transition-all duration-150 bottom-1 w-full pr-3 box-content h-6
        bg-[#C7A077] rounded-full z-0 group-hover:opacity-100
        #{'opacity-0' unless highlight}
        #{underline_attr.delete(:class)}".strip,
      data: { kind: "underline" }.merge(underline_attr.delete(:data) || {}),
      **underline_attr
    ) %>
  <% end %>
<% end %>
