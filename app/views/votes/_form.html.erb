<%= form_with(model: [project, vote],
  url: votes_path,
  class: "space-y-4",
  id: "vote_form_#{project.id}",
  data: {
    controller: "form",
    action: "submit->form#preventDoubleSubmission",
    voting_steps_target: "form",
    project_id: project.id,
    "data-analytics-form": ""
  },
  onclick: "event.stopPropagation()") do |f| %>
  <%= f.hidden_field :winning_project_id, value: project.id %>

  <%= f.hidden_field :project_1_demo_opened, value: false, data: { voting_steps_target: "project1DemoOpenedInput" } %>
  <%= f.hidden_field :project_1_readme_opened, value: false, data: { voting_steps_target: "project1ReadmeOpenedInput" } %>
  <%= f.hidden_field :project_1_repo_opened, value: false, data: { voting_steps_target: "project1RepoOpenedInput" } %>
  <%= f.hidden_field :project_2_demo_opened, value: false, data: { voting_steps_target: "project2DemoOpenedInput" } %>
  <%= f.hidden_field :project_2_readme_opened, value: false, data: { voting_steps_target: "project2ReadmeOpenedInput" } %>
  <%= f.hidden_field :project_2_repo_opened, value: false, data: { voting_steps_target: "project2RepoOpenedInput" } %>

  <%= f.hidden_field :time_spent_voting_ms, data: { voting_steps_target: "timeSpentVotingInput" } %>
  <%= f.hidden_field :music_played, value: false, data: { voting_steps_target: "musicPlayedInput" } %>

  <% token = session[:vote_tokens].keys.find { |k| session[:vote_tokens][k]["project_id"] == project.id } %>
  <%= hidden_field_tag :vote_token, token %>

  <div class="space-y-2" onclick="event.stopPropagation()">
    <%= f.label :explanation, "Why this project?", class: "block text-lg font-medium text-forest" %>
    <%= f.text_area :explanation,
      class: "w-full p-3 border-2 border-[#E4DCC6] focus:outline-none focus:border-forest bg-white rounded-lg text-base #{'border-vintage-red' if vote.errors[:explanation].any?}",
      rows: 3,
      required: true,
      placeholder: "I like this project because...",
      onclick: "event.stopPropagation()" %>

    <% if vote.errors[:explanation].any? %>
      <div class="text-vintage-red text-sm mt-1">
        <%= vote.errors[:explanation].join(", ") %>
      </div>
    <% end %>
  </div>

  <div class="flex justify-center pt-2" onclick="event.stopPropagation()">
    <%= f.submit "Vote for this project",
      class: "w-full px-6 py-3 bg-forest hover:scale-[1.05] text-white transition-transform duration-300 text-lg font-medium btn-pixel cursor-pointer",
      data: { form_target: "submitButton" },
      onclick: "event.stopPropagation()" %>
  </div>
<% end %>
