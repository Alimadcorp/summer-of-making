<%= form_with(model: vote,
  url: votes_path,
  class: "space-y-6",
  data: {
    controller: "form",
    action: "submit->form#preventDoubleSubmission",
    "data-analytics-form": ""
  }) do |f| %>

  <%# Ship event IDs and signature for secure voting %>
  <%= f.hidden_field :ship_event_1_id, value: @ship_events&.first&.id %>
  <%= f.hidden_field :ship_event_2_id, value: @ship_events&.last&.id %>
  <%= f.hidden_field :signature, value: @vote_signature %>

  <%= f.hidden_field :project_1_demo_opened, value: false, data: { voting_steps_target: "project1DemoOpenedInput" } %>
  <%= f.hidden_field :project_1_readme_opened, value: false, data: { voting_steps_target: "project1ReadmeOpenedInput" } %>
  <%= f.hidden_field :project_1_repo_opened, value: false, data: { voting_steps_target: "project1RepoOpenedInput" } %>
  <%= f.hidden_field :project_2_demo_opened, value: false, data: { voting_steps_target: "project2DemoOpenedInput" } %>
  <%= f.hidden_field :project_2_readme_opened, value: false, data: { voting_steps_target: "project2ReadmeOpenedInput" } %>
  <%= f.hidden_field :project_2_repo_opened, value: false, data: { voting_steps_target: "project2RepoOpenedInput" } %>
  <%= f.hidden_field :time_spent_voting_ms, value: 0, data: { voting_steps_target: "timeSpentVotingInput" } %>
  <%= f.hidden_field :music_played, value: false, data: { voting_steps_target: "musicPlayedInput" } %>

  <div class="text-center">
    <h3 class="text-xl sm:text-2xl mb-6 text-gray-700">Cast Your Vote</h3>

    <div class="flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-6 mb-6">
      <label class="flex items-center cursor-pointer">
        <%= f.radio_button :winning_project_id, @projects.first.id, class: "sr-only peer" %>
        <div class="marble-button peer-checked:bg-forest peer-checked:text-white peer-checked:border-forest-dark transition-colors duration-300 text-base sm:text-lg text-center min-w-0">
          <span class="block sm:hidden">Project 1</span>
          <span class="hidden sm:block">Project 1 – <%= truncate(@projects.first.title, length: 20) %></span>
        </div>
      </label>

      <label class="flex items-center cursor-pointer">
        <%= f.radio_button :winning_project_id, "", class: "sr-only peer" %>
        <div class="marble-button peer-checked:bg-nice-blue peer-checked:text-white peer-checked:border-nice-blue-dark transition-colors duration-300 text-base sm:text-lg text-center min-w-0">
          Tie
        </div>
      </label>

      <label class="flex items-center cursor-pointer">
        <%= f.radio_button :winning_project_id, @projects.last.id, class: "sr-only peer" %>
        <div class="marble-button peer-checked:bg-saddle-taupe peer-checked:text-white peer-checked:border-saddle-taupe-dark transition-colors duration-300 text-base sm:text-lg text-center min-w-0">
          <span class="block sm:hidden">Project 2</span>
          <span class="hidden sm:block">Project 2 – <%= truncate(@projects.last.title, length: 20) %></span>
        </div>
      </label>
    </div>
  </div>

  <div class="space-y-2">
    <%= f.text_area :explanation,
      class: "w-full p-3 border-2 rounded border-saddle-taupe/70 focus:outline-none focus:border-fores text-base #{'border-vintage-red' if vote.errors[:explanation].any?}",
      rows: 4,
      required: true,
      placeholder: "Tell us why you made this choice..." %>

    <% if vote.errors[:explanation].any? %>
      <div class="text-vintage-red text-sm mt-1">
        <%= vote.errors[:explanation].join(", ") %>
      </div>
    <% end %>
  </div>

  <div class="text-center">
    <%= f.submit "Submit Vote",
      class: "px-6 sm:px-8 py-2 sm:py-3 bg-forest hover:scale-[1.05] text-white transition-transform duration-300 btn-pixel text-base sm:text-lg disabled:bg-gray-400 disabled:hover:scale-100 disabled:cursor-not-allowed",
      data: { form_target: "submitButton" } %>
  </div>
<% end %>
